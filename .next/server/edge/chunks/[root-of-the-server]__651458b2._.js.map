{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/app/api/upload/route.ts"],"sourcesContent":["export const runtime = \"edge\";\n\ntype FontType = \"font1\" | \"font2\";\n\nconst fontConfigs: Record<FontType, { name: string; style: string }> = {\n  font1: { name: \"Arial\", style: \"bold 120px Arial\" },\n  font2: { name: \"Courier\", style: \"bold 120px Courier New, monospace\" },\n};\n\nasync function generateImage(texte: string, fontType: FontType = \"font1\"): Promise<ArrayBuffer> {\n  const canvas = new OffscreenCanvas(1200, 400);\n  const ctx = canvas.getContext(\"2d\");\n  \n  if (!ctx) throw new Error(\"Cannot get canvas context\");\n\n  // Fond transparent\n  ctx.clearRect(0, 0, 1200, 400);\n\n  // Texte stylisé\n  ctx.fillStyle = \"rgba(53, 121, 247, 0.66)\";\n  ctx.font = fontConfigs[fontType].style;\n  ctx.textAlign = \"center\";\n  ctx.textBaseline = \"middle\";\n  \n  // Appliquer le shadow effect\n  ctx.shadowColor = \"rgba(29, 71, 255, 0.72)\";\n  ctx.shadowBlur = 40;\n  ctx.shadowOffsetX = 0;\n  ctx.shadowOffsetY = 0;\n\n  ctx.fillText(texte, 600, 200);\n\n  return canvas.convertToBlob({ type: \"image/png\" }).then(blob => blob.arrayBuffer());\n}\n\nexport async function POST(req: Request) {\n  try {\n    const { texte, font } = await req.json();\n\n    if (!texte || typeof texte !== \"string\") {\n      return Response.json(\n        { error: \"Texte invalide\" },\n        { status: 400 }\n      );\n    }\n\n    const fontType = (font === \"font2\" ? \"font2\" : \"font1\") as FontType;\n\n    // Générer l'image\n    const imageArrayBuffer = await generateImage(texte, fontType);\n    const imageBuffer = new Uint8Array(imageArrayBuffer);\n    const base64Image = Buffer.from(imageBuffer).toString(\"base64\");\n\n    // Uploader sur ImgBB\n    const formData = new FormData();\n    formData.append(\"image\", base64Image);\n    formData.append(\"key\", process.env.IMGBB_API_KEY || \"\");\n\n    const imgbbResponse = await fetch(\"https://api.imgbb.com/1/upload\", {\n      method: \"POST\",\n      body: formData,\n    });\n\n    if (!imgbbResponse.ok) {\n      console.error(\"ImgBB error:\", imgbbResponse.status);\n      return Response.json(\n        { error: \"Erreur lors de l'upload sur ImgBB\" },\n        { status: 500 }\n      );\n    }\n\n    const imgbbData = await imgbbResponse.json() as { data?: { url?: string } };\n\n    if (!imgbbData.data?.url) {\n      return Response.json(\n        { error: \"Pas d'URL retournée par ImgBB\" },\n        { status: 500 }\n      );\n    }\n\n    return Response.json({\n      success: true,\n      imageUrl: imgbbData.data.url,\n    });\n  } catch (error) {\n    console.error(\"Erreur:\", error);\n    return Response.json(\n      { error: \"Erreur serveur\" },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;;;AAmDwB;AAnDjB,MAAM,UAAU;AAIvB,MAAM,cAAiE;IACrE,OAAO;QAAE,MAAM;QAAS,OAAO;IAAmB;IAClD,OAAO;QAAE,MAAM;QAAW,OAAO;IAAoC;AACvE;AAEA,eAAe,cAAc,KAAa,EAAE,WAAqB,OAAO;IACtE,MAAM,SAAS,IAAI,gBAAgB,MAAM;IACzC,MAAM,MAAM,OAAO,UAAU,CAAC;IAE9B,IAAI,CAAC,KAAK,MAAM,IAAI,MAAM;IAE1B,mBAAmB;IACnB,IAAI,SAAS,CAAC,GAAG,GAAG,MAAM;IAE1B,gBAAgB;IAChB,IAAI,SAAS,GAAG;IAChB,IAAI,IAAI,GAAG,WAAW,CAAC,SAAS,CAAC,KAAK;IACtC,IAAI,SAAS,GAAG;IAChB,IAAI,YAAY,GAAG;IAEnB,6BAA6B;IAC7B,IAAI,WAAW,GAAG;IAClB,IAAI,UAAU,GAAG;IACjB,IAAI,aAAa,GAAG;IACpB,IAAI,aAAa,GAAG;IAEpB,IAAI,QAAQ,CAAC,OAAO,KAAK;IAEzB,OAAO,OAAO,aAAa,CAAC;QAAE,MAAM;IAAY,GAAG,IAAI,CAAC,CAAA,OAAQ,KAAK,WAAW;AAClF;AAEO,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,MAAM,EAAE,KAAK,EAAE,IAAI,EAAE,GAAG,MAAM,IAAI,IAAI;QAEtC,IAAI,CAAC,SAAS,OAAO,UAAU,UAAU;YACvC,OAAO,SAAS,IAAI,CAClB;gBAAE,OAAO;YAAiB,GAC1B;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,WAAY,SAAS,UAAU,UAAU;QAE/C,kBAAkB;QAClB,MAAM,mBAAmB,MAAM,cAAc,OAAO;QACpD,MAAM,cAAc,IAAI,WAAW;QACnC,MAAM,cAAc,+HAAM,CAAC,IAAI,CAAC,aAAa,QAAQ,CAAC;QAEtD,qBAAqB;QACrB,MAAM,WAAW,IAAI;QACrB,SAAS,MAAM,CAAC,SAAS;QACzB,SAAS,MAAM,CAAC,OAAO,QAAQ,GAAG,CAAC,aAAa,IAAI;QAEpD,MAAM,gBAAgB,MAAM,MAAM,kCAAkC;YAClE,QAAQ;YACR,MAAM;QACR;QAEA,IAAI,CAAC,cAAc,EAAE,EAAE;YACrB,QAAQ,KAAK,CAAC,gBAAgB,cAAc,MAAM;YAClD,OAAO,SAAS,IAAI,CAClB;gBAAE,OAAO;YAAoC,GAC7C;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,YAAY,MAAM,cAAc,IAAI;QAE1C,IAAI,CAAC,UAAU,IAAI,EAAE,KAAK;YACxB,OAAO,SAAS,IAAI,CAClB;gBAAE,OAAO;YAAgC,GACzC;gBAAE,QAAQ;YAAI;QAElB;QAEA,OAAO,SAAS,IAAI,CAAC;YACnB,SAAS;YACT,UAAU,UAAU,IAAI,CAAC,GAAG;QAC9B;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,WAAW;QACzB,OAAO,SAAS,IAAI,CAClB;YAAE,OAAO;QAAiB,GAC1B;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}
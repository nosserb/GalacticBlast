{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 61, "column": 0}, "map": {"version":3,"sources":["file:///home/student/autre%20projets/GalacticBlast/app/api/upload/route.ts"],"sourcesContent":["import sharp from \"sharp\";\nimport fs from \"fs\";\nimport path from \"path\";\n\nexport const runtime = \"nodejs\";\n\ntype FontType = \"highspeed\" | \"lady-radical\";\n\nconst fontConfigs: Record<FontType, { name: string; file: string }> = {\n  highspeed: { name: \"HIGHSPEED\", file: \"HIGHSPEED.TTF\" },\n  \"lady-radical\": { name: \"Lady Radical\", file: \"Lady Radical.ttf\" },\n};\n\nasync function generateImage(texte: string, fontType: FontType = \"highspeed\", color: string = \"#3579f7\"): Promise<Buffer> {\n  const fontConfig = fontConfigs[fontType];\n  const fontPath = path.join(process.cwd(), \"public\", \"fonts\", fontConfig.file);\n  \n  // Vérifier que le fichier existe\n  if (!fs.existsSync(fontPath)) {\n    throw new Error(`Police non trouvée: ${fontPath}`);\n  }\n\n  // Convertir hex en rgba si nécessaire\n  let fillColor = color;\n  if (color.startsWith(\"#\")) {\n    const hex = color.replace(\"#\", \"\");\n    const r = parseInt(hex.substring(0, 2), 16);\n    const g = parseInt(hex.substring(2, 4), 16);\n    const b = parseInt(hex.substring(4, 6), 16);\n    fillColor = `rgb(${r}, ${g}, ${b})`;\n  }\n\n  // Créer une image SVG avec le texte et la police personnalisée\n  const svg = `\n    <svg width=\"1200\" height=\"400\" xmlns=\"http://www.w3.org/2000/svg\">\n      <defs>\n        <style>\n          @font-face {\n            font-family: '${fontConfig.name}';\n            src: url('file://${fontPath}');\n          }\n        </style>\n        <filter id=\"glow\">\n          <feGaussianBlur stdDeviation=\"4\" result=\"coloredBlur\"/>\n          <feMerge>\n            <feMergeNode in=\"coloredBlur\"/>\n            <feMergeNode in=\"SourceGraphic\"/>\n          </feMerge>\n        </filter>\n      </defs>\n      <text x=\"600\" y=\"200\" font-size=\"120\" font-weight=\"bold\" \n            text-anchor=\"middle\" dominant-baseline=\"middle\"\n            font-family=\"${fontConfig.name}\"\n            fill=\"${fillColor}\" \n            filter=\"url(#glow)\">\n        ${texte.replace(/&/g, \"&amp;\").replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\")}\n      </text>\n    </svg>\n  `;\n\n  return await sharp(Buffer.from(svg))\n    .png()\n    .toBuffer();\n}\n\nexport async function POST(req: Request) {\n  try {\n    const { texte, font, color } = await req.json();\n\n    if (!texte || typeof texte !== \"string\") {\n      return Response.json(\n        { error: \"Texte invalide\" },\n        { status: 400 }\n      );\n    }\n\n    const fontType = (font === \"lady-radical\" ? \"lady-radical\" : \"highspeed\") as FontType;\n\n    // Générer l'image\n    const imageBuffer = await generateImage(texte, fontType, color || \"#3579f7\");\n    const base64Image = imageBuffer.toString(\"base64\");\n\n    // Uploader sur ImgBB\n    const formData = new FormData();\n    formData.append(\"image\", base64Image);\n    formData.append(\"key\", process.env.IMGBB_API_KEY || \"\");\n\n    const imgbbResponse = await fetch(\"https://api.imgbb.com/1/upload\", {\n      method: \"POST\",\n      body: formData,\n    });\n\n    if (!imgbbResponse.ok) {\n      console.error(\"ImgBB error:\", imgbbResponse.status);\n      return Response.json(\n        { error: \"Erreur lors de l'upload sur ImgBB\" },\n        { status: 500 }\n      );\n    }\n\n    const imgbbData = await imgbbResponse.json() as { data?: { url?: string } };\n\n    if (!imgbbData.data?.url) {\n      return Response.json(\n        { error: \"Pas d'URL retournée par ImgBB\" },\n        { status: 500 }\n      );\n    }\n\n    return Response.json({\n      success: true,\n      imageUrl: imgbbData.data.url,\n    });\n  } catch (error) {\n    console.error(\"Erreur:\", error);\n    return Response.json(\n      { error: \"Erreur serveur\" },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;AAEO,MAAM,UAAU;AAIvB,MAAM,cAAgE;IACpE,WAAW;QAAE,MAAM;QAAa,MAAM;IAAgB;IACtD,gBAAgB;QAAE,MAAM;QAAgB,MAAM;IAAmB;AACnE;AAEA,eAAe,cAAc,KAAa,EAAE,WAAqB,WAAW,EAAE,QAAgB,SAAS;IACrG,MAAM,aAAa,WAAW,CAAC,SAAS;IACxC,MAAM,WAAW,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,UAAU,SAAS,WAAW,IAAI;IAE5E,iCAAiC;IACjC,IAAI,CAAC,wGAAE,CAAC,UAAU,CAAC,WAAW;QAC5B,MAAM,IAAI,MAAM,CAAC,oBAAoB,EAAE,UAAU;IACnD;IAEA,sCAAsC;IACtC,IAAI,YAAY;IAChB,IAAI,MAAM,UAAU,CAAC,MAAM;QACzB,MAAM,MAAM,MAAM,OAAO,CAAC,KAAK;QAC/B,MAAM,IAAI,SAAS,IAAI,SAAS,CAAC,GAAG,IAAI;QACxC,MAAM,IAAI,SAAS,IAAI,SAAS,CAAC,GAAG,IAAI;QACxC,MAAM,IAAI,SAAS,IAAI,SAAS,CAAC,GAAG,IAAI;QACxC,YAAY,CAAC,IAAI,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC,CAAC;IACrC;IAEA,+DAA+D;IAC/D,MAAM,MAAM,CAAC;;;;;0BAKW,EAAE,WAAW,IAAI,CAAC;6BACf,EAAE,SAAS;;;;;;;;;;;;;yBAaf,EAAE,WAAW,IAAI,CAAC;kBACzB,EAAE,UAAU;;QAEtB,EAAE,MAAM,OAAO,CAAC,MAAM,SAAS,OAAO,CAAC,MAAM,QAAQ,OAAO,CAAC,MAAM,QAAQ;;;EAGjF,CAAC;IAED,OAAO,MAAM,IAAA,8GAAK,EAAC,OAAO,IAAI,CAAC,MAC5B,GAAG,GACH,QAAQ;AACb;AAEO,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,MAAM,EAAE,KAAK,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,IAAI,IAAI;QAE7C,IAAI,CAAC,SAAS,OAAO,UAAU,UAAU;YACvC,OAAO,SAAS,IAAI,CAClB;gBAAE,OAAO;YAAiB,GAC1B;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,WAAY,SAAS,iBAAiB,iBAAiB;QAE7D,kBAAkB;QAClB,MAAM,cAAc,MAAM,cAAc,OAAO,UAAU,SAAS;QAClE,MAAM,cAAc,YAAY,QAAQ,CAAC;QAEzC,qBAAqB;QACrB,MAAM,WAAW,IAAI;QACrB,SAAS,MAAM,CAAC,SAAS;QACzB,SAAS,MAAM,CAAC,OAAO,QAAQ,GAAG,CAAC,aAAa,IAAI;QAEpD,MAAM,gBAAgB,MAAM,MAAM,kCAAkC;YAClE,QAAQ;YACR,MAAM;QACR;QAEA,IAAI,CAAC,cAAc,EAAE,EAAE;YACrB,QAAQ,KAAK,CAAC,gBAAgB,cAAc,MAAM;YAClD,OAAO,SAAS,IAAI,CAClB;gBAAE,OAAO;YAAoC,GAC7C;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,YAAY,MAAM,cAAc,IAAI;QAE1C,IAAI,CAAC,UAAU,IAAI,EAAE,KAAK;YACxB,OAAO,SAAS,IAAI,CAClB;gBAAE,OAAO;YAAgC,GACzC;gBAAE,QAAQ;YAAI;QAElB;QAEA,OAAO,SAAS,IAAI,CAAC;YACnB,SAAS;YACT,UAAU,UAAU,IAAI,CAAC,GAAG;QAC9B;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,WAAW;QACzB,OAAO,SAAS,IAAI,CAClB;YAAE,OAAO;QAAiB,GAC1B;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}
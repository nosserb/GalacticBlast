{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 49, "column": 0}, "map": {"version":3,"sources":["file:///home/student/autre%20projets/GalacticBlast/app/api/upload/route.ts"],"sourcesContent":["import sharp from \"sharp\";\n\nexport const runtime = \"nodejs\";\n\ntype FontType = \"font1\" | \"font2\";\n\nconst fontConfigs: Record<FontType, { name: string; style: string }> = {\n  font1: { name: \"Arial\", style: \"bold 120px Arial\" },\n  font2: { name: \"Courier\", style: \"bold 120px Courier New, monospace\" },\n};\n\nasync function generateImage(texte: string, fontType: FontType = \"font1\"): Promise<Buffer> {\n  const fontStyle = fontConfigs[fontType].style;\n  \n  // Créer une image SVG avec le texte\n  const svg = Buffer.from(`\n    <svg width=\"1200\" height=\"400\" xmlns=\"http://www.w3.org/2000/svg\">\n      <defs>\n        <filter id=\"glow\">\n          <feGaussianBlur stdDeviation=\"4\" result=\"coloredBlur\"/>\n          <feMerge>\n            <feMergeNode in=\"coloredBlur\"/>\n            <feMergeNode in=\"SourceGraphic\"/>\n          </feMerge>\n        </filter>\n      </defs>\n      <text x=\"600\" y=\"200\" font-size=\"120\" font-weight=\"bold\" \n            text-anchor=\"middle\" dominant-baseline=\"middle\"\n            fill=\"rgba(53, 121, 247, 0.66)\" \n            style=\"font-family: ${fontStyle.split(\" \").pop() || \"Arial\"}; filter: url(#glow);\"\n            filter=\"url(#glow)\">\n        ${texte}\n      </text>\n    </svg>\n  `);\n\n  return await sharp(svg)\n    .png()\n    .toBuffer();\n}\n\nexport async function POST(req: Request) {\n  try {\n    const { texte, font } = await req.json();\n\n    if (!texte || typeof texte !== \"string\") {\n      return Response.json(\n        { error: \"Texte invalide\" },\n        { status: 400 }\n      );\n    }\n\n    const fontType = (font === \"font2\" ? \"font2\" : \"font1\") as FontType;\n\n    // Générer l'image\n    const imageBuffer = await generateImage(texte, fontType);\n    const base64Image = imageBuffer.toString(\"base64\");\n\n    // Uploader sur ImgBB\n    const formData = new FormData();\n    formData.append(\"image\", base64Image);\n    formData.append(\"key\", process.env.IMGBB_API_KEY || \"\");\n\n    const imgbbResponse = await fetch(\"https://api.imgbb.com/1/upload\", {\n      method: \"POST\",\n      body: formData,\n    });\n\n    if (!imgbbResponse.ok) {\n      console.error(\"ImgBB error:\", imgbbResponse.status);\n      return Response.json(\n        { error: \"Erreur lors de l'upload sur ImgBB\" },\n        { status: 500 }\n      );\n    }\n\n    const imgbbData = await imgbbResponse.json() as { data?: { url?: string } };\n\n    if (!imgbbData.data?.url) {\n      return Response.json(\n        { error: \"Pas d'URL retournée par ImgBB\" },\n        { status: 500 }\n      );\n    }\n\n    return Response.json({\n      success: true,\n      imageUrl: imgbbData.data.url,\n    });\n  } catch (error) {\n    console.error(\"Erreur:\", error);\n    return Response.json(\n      { error: \"Erreur serveur\" },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;;AAEO,MAAM,UAAU;AAIvB,MAAM,cAAiE;IACrE,OAAO;QAAE,MAAM;QAAS,OAAO;IAAmB;IAClD,OAAO;QAAE,MAAM;QAAW,OAAO;IAAoC;AACvE;AAEA,eAAe,cAAc,KAAa,EAAE,WAAqB,OAAO;IACtE,MAAM,YAAY,WAAW,CAAC,SAAS,CAAC,KAAK;IAE7C,oCAAoC;IACpC,MAAM,MAAM,OAAO,IAAI,CAAC,CAAC;;;;;;;;;;;;;;gCAcK,EAAE,UAAU,KAAK,CAAC,KAAK,GAAG,MAAM,QAAQ;;QAEhE,EAAE,MAAM;;;EAGd,CAAC;IAED,OAAO,MAAM,IAAA,8GAAK,EAAC,KAChB,GAAG,GACH,QAAQ;AACb;AAEO,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,MAAM,EAAE,KAAK,EAAE,IAAI,EAAE,GAAG,MAAM,IAAI,IAAI;QAEtC,IAAI,CAAC,SAAS,OAAO,UAAU,UAAU;YACvC,OAAO,SAAS,IAAI,CAClB;gBAAE,OAAO;YAAiB,GAC1B;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,WAAY,SAAS,UAAU,UAAU;QAE/C,kBAAkB;QAClB,MAAM,cAAc,MAAM,cAAc,OAAO;QAC/C,MAAM,cAAc,YAAY,QAAQ,CAAC;QAEzC,qBAAqB;QACrB,MAAM,WAAW,IAAI;QACrB,SAAS,MAAM,CAAC,SAAS;QACzB,SAAS,MAAM,CAAC,OAAO,QAAQ,GAAG,CAAC,aAAa,IAAI;QAEpD,MAAM,gBAAgB,MAAM,MAAM,kCAAkC;YAClE,QAAQ;YACR,MAAM;QACR;QAEA,IAAI,CAAC,cAAc,EAAE,EAAE;YACrB,QAAQ,KAAK,CAAC,gBAAgB,cAAc,MAAM;YAClD,OAAO,SAAS,IAAI,CAClB;gBAAE,OAAO;YAAoC,GAC7C;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,YAAY,MAAM,cAAc,IAAI;QAE1C,IAAI,CAAC,UAAU,IAAI,EAAE,KAAK;YACxB,OAAO,SAAS,IAAI,CAClB;gBAAE,OAAO;YAAgC,GACzC;gBAAE,QAAQ;YAAI;QAElB;QAEA,OAAO,SAAS,IAAI,CAAC;YACnB,SAAS;YACT,UAAU,UAAU,IAAI,CAAC,GAAG;QAC9B;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,WAAW;QACzB,OAAO,SAAS,IAAI,CAClB;YAAE,OAAO;QAAiB,GAC1B;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}
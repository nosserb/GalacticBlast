{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 61, "column": 0}, "map": {"version":3,"sources":["file:///home/student/autre%20projets/GalacticBlast/app/api/upload/route.ts"],"sourcesContent":["import { createCanvas, registerFont } from \"canvas\";\nimport path from \"path\";\nimport fs from \"fs\";\n\nexport const runtime = \"nodejs\";\n\ntype FontType = \"highspeed\" | \"lady-radical\";\n\nconst fontConfigs: Record<FontType, { name: string; file: string }> = {\n  highspeed: { name: \"HIGHSPEED\", file: \"HIGHSPEED.TTF\" },\n  \"lady-radical\": { name: \"Lady Radical\", file: \"Lady Radical.ttf\" },\n};\n\n// Enregistrer les polices\nObject.entries(fontConfigs).forEach(([, config]) => {\n  const fontPath = path.join(process.cwd(), \"public\", \"fonts\", config.file);\n  if (fs.existsSync(fontPath)) {\n    registerFont(fontPath, { family: config.name });\n  }\n});\n\nasync function generateImage(texte: string, fontType: FontType = \"highspeed\", color: string = \"#3579f7\", fontSize: number = 100): Promise<Buffer> {\n  const fontConfig = fontConfigs[fontType];\n  const canvas = createCanvas(1200, 400);\n  const ctx = canvas.getContext(\"2d\");\n\n  // Fond transparent\n  ctx.clearRect(0, 0, 1200, 400);\n\n  // Glow effect (fond flou)\n  ctx.fillStyle = color.startsWith(\"#\") ? color + \"30\" : color.replace(\"rgb\", \"rgba\").replace(\")\", \", 0.2)\");\n  ctx.shadowColor = color;\n  ctx.shadowBlur = 50;\n  ctx.shadowOffsetX = 0;\n  ctx.shadowOffsetY = 0;\n\n  // Texte\n  ctx.font = `bold ${fontSize}px ${fontConfig.name}`;\n  ctx.fillStyle = color;\n  ctx.textAlign = \"center\";\n  ctx.textBaseline = \"middle\";\n  ctx.fillText(texte, 600, 200);\n\n  return canvas.toBuffer(\"image/png\");\n}\n\nexport async function POST(req: Request) {\n  try {\n    const { texte, font, color, fontSize } = await req.json();\n\n    if (!texte || typeof texte !== \"string\") {\n      return Response.json(\n        { error: \"Texte invalide\" },\n        { status: 400 }\n      );\n    }\n\n    const fontType = (font === \"lady-radical\" ? \"lady-radical\" : \"highspeed\") as FontType;\n\n    // Générer l'image\n    const imageBuffer = await generateImage(texte, fontType, color || \"#3579f7\", fontSize || 100);\n    const base64Image = imageBuffer.toString(\"base64\");\n\n    // Uploader sur ImgBB\n    const formData = new FormData();\n    formData.append(\"image\", base64Image);\n    formData.append(\"key\", process.env.IMGBB_API_KEY || \"\");\n\n    const imgbbResponse = await fetch(\"https://api.imgbb.com/1/upload\", {\n      method: \"POST\",\n      body: formData,\n    });\n\n    if (!imgbbResponse.ok) {\n      console.error(\"ImgBB error:\", imgbbResponse.status);\n      return Response.json(\n        { error: \"Erreur lors de l'upload sur ImgBB\" },\n        { status: 500 }\n      );\n    }\n\n    const imgbbData = await imgbbResponse.json() as { data?: { url?: string } };\n\n    if (!imgbbData.data?.url) {\n      return Response.json(\n        { error: \"Pas d'URL retournée par ImgBB\" },\n        { status: 500 }\n      );\n    }\n\n    return Response.json({\n      success: true,\n      imageUrl: imgbbData.data.url,\n    });\n  } catch (error) {\n    console.error(\"Erreur:\", error);\n    return Response.json(\n      { error: \"Erreur serveur\" },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;AAEO,MAAM,UAAU;AAIvB,MAAM,cAAgE;IACpE,WAAW;QAAE,MAAM;QAAa,MAAM;IAAgB;IACtD,gBAAgB;QAAE,MAAM;QAAgB,MAAM;IAAmB;AACnE;AAEA,0BAA0B;AAC1B,OAAO,OAAO,CAAC,aAAa,OAAO,CAAC,CAAC,GAAG,OAAO;IAC7C,MAAM,WAAW,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,UAAU,SAAS,OAAO,IAAI;IACxE,IAAI,wGAAE,CAAC,UAAU,CAAC,WAAW;QAC3B,IAAA,qHAAY,EAAC,UAAU;YAAE,QAAQ,OAAO,IAAI;QAAC;IAC/C;AACF;AAEA,eAAe,cAAc,KAAa,EAAE,WAAqB,WAAW,EAAE,QAAgB,SAAS,EAAE,WAAmB,GAAG;IAC7H,MAAM,aAAa,WAAW,CAAC,SAAS;IACxC,MAAM,SAAS,IAAA,qHAAY,EAAC,MAAM;IAClC,MAAM,MAAM,OAAO,UAAU,CAAC;IAE9B,mBAAmB;IACnB,IAAI,SAAS,CAAC,GAAG,GAAG,MAAM;IAE1B,0BAA0B;IAC1B,IAAI,SAAS,GAAG,MAAM,UAAU,CAAC,OAAO,QAAQ,OAAO,MAAM,OAAO,CAAC,OAAO,QAAQ,OAAO,CAAC,KAAK;IACjG,IAAI,WAAW,GAAG;IAClB,IAAI,UAAU,GAAG;IACjB,IAAI,aAAa,GAAG;IACpB,IAAI,aAAa,GAAG;IAEpB,QAAQ;IACR,IAAI,IAAI,GAAG,CAAC,KAAK,EAAE,SAAS,GAAG,EAAE,WAAW,IAAI,EAAE;IAClD,IAAI,SAAS,GAAG;IAChB,IAAI,SAAS,GAAG;IAChB,IAAI,YAAY,GAAG;IACnB,IAAI,QAAQ,CAAC,OAAO,KAAK;IAEzB,OAAO,OAAO,QAAQ,CAAC;AACzB;AAEO,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,MAAM,EAAE,KAAK,EAAE,IAAI,EAAE,KAAK,EAAE,QAAQ,EAAE,GAAG,MAAM,IAAI,IAAI;QAEvD,IAAI,CAAC,SAAS,OAAO,UAAU,UAAU;YACvC,OAAO,SAAS,IAAI,CAClB;gBAAE,OAAO;YAAiB,GAC1B;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,WAAY,SAAS,iBAAiB,iBAAiB;QAE7D,kBAAkB;QAClB,MAAM,cAAc,MAAM,cAAc,OAAO,UAAU,SAAS,WAAW,YAAY;QACzF,MAAM,cAAc,YAAY,QAAQ,CAAC;QAEzC,qBAAqB;QACrB,MAAM,WAAW,IAAI;QACrB,SAAS,MAAM,CAAC,SAAS;QACzB,SAAS,MAAM,CAAC,OAAO,QAAQ,GAAG,CAAC,aAAa,IAAI;QAEpD,MAAM,gBAAgB,MAAM,MAAM,kCAAkC;YAClE,QAAQ;YACR,MAAM;QACR;QAEA,IAAI,CAAC,cAAc,EAAE,EAAE;YACrB,QAAQ,KAAK,CAAC,gBAAgB,cAAc,MAAM;YAClD,OAAO,SAAS,IAAI,CAClB;gBAAE,OAAO;YAAoC,GAC7C;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,YAAY,MAAM,cAAc,IAAI;QAE1C,IAAI,CAAC,UAAU,IAAI,EAAE,KAAK;YACxB,OAAO,SAAS,IAAI,CAClB;gBAAE,OAAO;YAAgC,GACzC;gBAAE,QAAQ;YAAI;QAElB;QAEA,OAAO,SAAS,IAAI,CAAC;YACnB,SAAS;YACT,UAAU,UAAU,IAAI,CAAC,GAAG;QAC9B;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,WAAW;QACzB,OAAO,SAAS,IAAI,CAClB;YAAE,OAAO;QAAiB,GAC1B;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}